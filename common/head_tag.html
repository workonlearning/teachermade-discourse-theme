<!-- Provide functionality for custom search bar near the top of the page. -->
<script type="text/discourse-plugin" version="0.8">
  let loadScript = require('discourse/lib/load-script').default;
  api.onPageChange((url, title) => {
    window.searchForum = () => {
      const query = document.getElementById('searchField').value;
      if (query) {
        window.location.assign(`/search?q=${encodeURI(query)}`)
      }
    }
    document.getElementById('searchButton').addEventListener('click', window.searchForum)
    document.getElementById('searchField').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        window.searchForum();
      }
    });
  });
</script>

<!-- Use reopenWidget to override the home-logo widget and send a user to the TeacherMade site when the logo is clicked. -->
<script type="text/discourse-plugin" version="0.8.13">
api.reopenWidget("home-logo", {
  href() {
    return 'https://app.teachermade.com/app/';
  },
});
</script>

<!-- Add a home page icon/link to the header -->
<script type="text/discourse-plugin" version="0.8">
  const { iconNode } = require("discourse-common/lib/icon-library");
  api.decorateWidget('header-icons:before', helper => {
      return helper.h('li', [
          helper.h('a.icon', {
              href:'/',
              title: 'Home'
          }, iconNode('home')),
      ]);
  });
</script>

<!-- 
  Add a custom class to the body tag for the home page. This allows us to 
  use CSS in common.css to show/hide things based on whether we are on the 
  home page
-->
<script type="text/discourse-plugin" version="0.8">
  api.onPageChange((url, title) => {
    if (url === '/') {
      $('body').addClass('home-page');
    }
    else {
      $('body').removeClass('home-page');
    }
  });
</script>

<!-- Add a link to the /tags page in the navigation bar. -->
<script type="text/discourse-plugin" version="0.8">
  api.addNavigationBarItem({
    name: "link-to-tags",
    displayName: "Browse all tags",
    href: "/tags",
    title: "Browse all of the forum tags",
    // At some point, we might want to only add the custom link in specific situations.
    // customFilter: (category, args, router) => { -->
    //   return category && category.slug === 'community'
    // }
  })
</script>
<script type="text/discourse-plugin" version="0.8">
  var tmAccordions = document.getElementsByClassName("tm-accordion");
  var tmIndex;

  for (tmIndex = 0; tmIndex < tmAccordions.length; tmIndex++) {
    tmAccordions[tmIndex].addEventListener("click", function() {
      console.log('clicked accordion this', this, 'next', this.nextElementSibling)
      this.classList.toggle("tm-accordion-active");
      var tmPanel = this.nextElementSibling;
      if (tmPanel.style.maxHeight) {
        tmPanel.style.maxHeight = null;
      } else {
        tmPanel.style.maxHeight = tmPanel.scrollHeight + "px";
      } 
    });
  }
</script>